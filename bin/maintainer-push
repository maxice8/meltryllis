#!/bin/sh
set -e

user="${1:?'missing first arg, username'}"
shift

if [ -z "${1:-}" ]; then
	branch="$(git branch --show-current)"
else
	branch="$1"
    shift
fi

# We expect this is in SSH because it is the only protocol we care about
# HTTPS users can switch to SSH
url="$(git remote get-url --push "$(guess-remote)" |
	sed -r "s|:(.+)/|:$user/|")"

git push --force "$@" "$url" HEAD:"$branch"
