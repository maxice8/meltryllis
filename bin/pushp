#!/bin/sh
if [ "$2" ]; then
	remote_branch="$2"
else
	_REALBASE="$(alpine-stable-prefix)"
	if [ -n "$_REALBASE" ]; then
		remote_branch="$_REALBASE-stable"
	else
		remote_branch=master
	fi
fi

# gitstream is the git remote that i push via SSH
# to alpine, in the future this will be joined into
# upstream which will hold gitlab
if [ "$1" ]; then
	remote="$1"
elif git config remote.gitstream.url >/dev/null; then
	remote=gitstream
elif git config remote.upstream.url >/dev/null; then
	remote=upstream
else
	remote=origin
fi

branch="$(git-current-branch)"

[ -n "$FORCE_PUSH" ] && args="--force"

pushurl="$(git config --local remote.$remote.pushurl || git config --local remote.$remote.url)"

git push --quiet $args $remote "$branch":"$remote_branch" >/dev/null || \
	printerr "Failed to push '$branch' into '$remote/$remote_branch' from '$pushurl'" && \
	printok "Pushed '$branch' into '$remote/$remote_branch' from '$pushurl'"
