#!/bin/sh
# Show git branches and switch to them
if [ ! -e .git ] || [ -z "$1" ]; then
	exit 1
fi

# gitstream is the git remote that i push via SSH
# to alpine, in the future this will be joined into
# upstream which will hold gitlab
if git config remote.gitstream.url >/dev/null; then
	remote=gitstream
elif git config remote.upstream.url >/dev/null; then
	remote=upstream
else
	remote=origin
fi

while [ $# -gt 0 ]; do
	if git rev-parse --quiet --verify "$1" >/dev/null 2>&1; then
		git switch "$1"
	else
		_RELBASE="$(alpine-stable-prefix "$1")"
		if [ -n "$_RELBASE" ]; then
			git switch --force-create "$1" $remote/"$_RELBASE"-stable
		else
			git switch --force-create "$1" $remote/master
		fi
	fi
	shift
done
