#!/bin/sh
# Show git branches and switch to them
if [ ! -e .git ] || [ -z "$1" ]; then
	exit 1
fi

if ! remote="$(PRINTERR_QUIET=1 guess-remote)"; then
	exit 1
fi

while [ $# -gt 0 ]; do
	if git rev-parse --quiet --verify "$1" >/dev/null 2>&1; then
		git switch --quiet "$1" || \
			printerr "Failed to switch to '$1'" && \
			printok "Switched to '$1'"
	else
		_REALBASE="$(alpine-stable-prefix "$1")"
		if [ -n "$_REALBASE" ]; then
			git switch --quiet --force-create "$1" $remote/"$_REALBASE"-stable || \
				printerr "Failed to switch to '$1'" && \
				printok "Switched to newly created '$1'"
		else
			git switch --quiet --force-create "$1" $remote/master || \
				printerr "Failed to switch to '$1'" && \
				printok "Switched to newly created '$1'"
		fi
	fi
	shift
done
