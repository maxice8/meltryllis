#!/bin/sh
[ $# -lt 1  ] && branch="$1" || branch=HEAD
branch=$branch'@{u}'

#
# If there is no tracking branch then this will error out, so supress stderr
# as it will return nothing in that case
#
_f="$(git rev-parse --abbrev-ref --symbolic-full-name "$branch" 2>/dev/null)"

#
# If there is no tracking branch then we can safely use our own branch name
#
if [ -z "$_f" ] || printf "%s" "$_f" | grep -F -q '@{u}'; then
	git branch --show-current
	exit 0
fi

#
# We only reach here if we have a tracking branch, which takes the form of
# <remote>/<branch>, split by the / and take the second value
#
printf "%s\\n" "$_f" | cut -d / -f 2
